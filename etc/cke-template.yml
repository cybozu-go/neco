name: neco
nodes:
- user: cybozu
  control_plane: true
  labels:
    cke.cybozu.com/role: "cs"
- user: cybozu
  control_plane: false
  labels:
    cke.cybozu.com/role: "cs"
    cke.cybozu.com/weight: "18"
- user: cybozu
  control_plane: false
  labels:
    cke.cybozu.com/role: "ss"
    cke.cybozu.com/weight: "10"
  taints:
  - key: cke.cybozu.com/role
    value: storage
    effect: NoExecute
service_subnet: 10.68.0.0/16
dns_service: internet-egress/unbound
reboot:
  command: ["/usr/bin/neco", "reboot-and-wait", "-"]
  eviction_timeout_seconds: 1800
  command_timeout_seconds: 1800
options:
  kube-api:
    extra_args:
      - "--enable-admission-plugins=PodSecurityPolicy"
      - "--feature-gates=EphemeralContainers=true"
  kube-controller-manager:
    extra_args:
      - "--feature-gates=EphemeralContainers=true"
  kube-proxy:
    extra_args:
      - "--ipvs-strict-arp=true"
      - "--feature-gates=EphemeralContainers=true"
  kube-scheduler:
    config:
      apiVersion: kubescheduler.config.k8s.io/v1alpha2
      kind: KubeSchedulerConfiguration
      leaderElection:
        leaderElect: true
      clientConnection:
        kubeconfig: /etc/kubernetes/scheduler.conf
      profiles:
        - schedulerName: default-scheduler
          plugins:
            score:
              disabled:
              - name: PodTopologySpread
              enabled:
              - name: PodTopologySpread
                weight: 500
      extenders:
      -  urlPrefix: "http://127.0.0.1:9251"
         filterVerb: predicate
         prioritizeVerb: prioritize
         nodeCacheCapable: false
         weight: 1
         managedResources:
         - name: topolvm.cybozu.com/capacity
           ignoredByScheduler: true
    extra_args:
      - "--feature-gates=EphemeralContainers=true"
  kubelet:
    extra_args:
      - "--containerd=/var/run/k8s-containerd.sock"
      - "--feature-gates=EphemeralContainers=true"
    extra_binds:
      - source: /var/lib/k8s-containerd
        destination: /var/lib/k8s-containerd
        read_only: false
    container_runtime: remote
    container_runtime_endpoint: unix:///var/run/k8s-containerd.sock
    container_log_max_size: 10Mi
    container_log_max_files: 10
  etcd:
    extra_args:
      - "--listen-metrics-urls=http://0.0.0.0:2381"
      # 8 * 1024 * 1024 * 1024 = 8589934592 = 8GB
      - "--quota-backend-bytes=8589934592"
      #GCPONLY - "--heartbeat-interval=500"
      #GCPONLY - "--election-timeout=2500"
