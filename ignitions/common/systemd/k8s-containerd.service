[Unit]
Description=containerd container runtime for kubernetes
ConditionPathExists=/etc/k8s-containerd/config.toml
Wants=setup-k8s-containerd.service
After=setup-k8s-containerd.service

[Service]
Delegate=yes
KillMode=process
Restart=always
ExecStartPre=/bin/mkdir -p /var/lib/k8s-containerd
ExecStartPre=/bin/mkdir -p /run/k8s-containerd
ExecStart=/opt/sbin/containerd --config /etc/k8s-containerd/config.toml
Environment="HTTP_PROXY={{ Metadata "proxy_url" }}"
Environment="HTTPS_PROXY={{ Metadata "proxy_url" }}"

# (lack of) limits from the upstream docker service unit
LimitNOFILE=1048576
LimitNPROC=infinity
LimitCORE=infinity
TasksMax=infinity

[Install]
WantedBy=multi-user.target
