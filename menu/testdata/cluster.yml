address: 10.0.0.1/24
kind: Network
name: internet
type: external
use-nat: true
---
kind: Network
name: core-to-s1
type: internal
use-nat: false
---
kind: Network
name: core-to-s2
type: internal
use-nat: false
---
kind: Network
name: core-to-ext
type: internal
use-nat: false
---
kind: Network
name: core-to-op
type: internal
use-nat: false
---
kind: Network
name: core-node0
type: internal
use-nat: false
---
kind: Network
name: core-ntp0
type: internal
use-nat: false
---
kind: Network
name: core-ntp1
type: internal
use-nat: false
---
address: 10.72.16.1/20
kind: Network
name: bmc
type: bmc
use-nat: false
---
kind: Network
name: s1-to-r0-1
type: internal
use-nat: false
---
kind: Network
name: s1-to-r0-2
type: internal
use-nat: false
---
kind: Network
name: s1-to-r1-1
type: internal
use-nat: false
---
kind: Network
name: s1-to-r1-2
type: internal
use-nat: false
---
kind: Network
name: s2-to-r0-1
type: internal
use-nat: false
---
kind: Network
name: s2-to-r0-2
type: internal
use-nat: false
---
kind: Network
name: s2-to-r1-1
type: internal
use-nat: false
---
kind: Network
name: s2-to-r1-2
type: internal
use-nat: false
---
kind: Network
name: r0-node1
type: internal
use-nat: false
---
kind: Network
name: r0-node2
type: internal
use-nat: false
---
kind: Network
name: r1-node1
type: internal
use-nat: false
---
kind: Network
name: r1-node2
type: internal
use-nat: false
---
kind: Image
name: ubuntu-cloud-image
url: https://cloud-images.ubuntu.com/releases/16.04/release/ubuntu-16.04-server-cloudimg-amd64-disk1.img
---
file: ./docker.img
kind: Image
name: docker-image
---
files:
- file: bird_core.conf
  name: bird.conf
- file: squid.conf
  name: squid.conf
- file: chrony.conf
  name: chrony.conf
kind: DataFolder
name: core-data
---
files:
- file: bird_spine1.conf
  name: bird.conf
kind: DataFolder
name: spine1-data
---
files:
- file: bird_spine2.conf
  name: bird.conf
kind: DataFolder
name: spine2-data
---
files:
- file: bird_rack0-tor1.conf
  name: bird.conf
kind: DataFolder
name: rack0-tor1-data
---
files:
- file: bird_rack0-tor2.conf
  name: bird.conf
kind: DataFolder
name: rack0-tor2-data
---
files:
- file: bird_rack1-tor1.conf
  name: bird.conf
kind: DataFolder
name: rack1-tor1-data
---
files:
- file: bird_rack1-tor2.conf
  name: bird.conf
kind: DataFolder
name: rack1-tor2-data
---
dir: sabakan
kind: DataFolder
name: sabakan-data
---
cpu: 2
interfaces:
- r0-node1
- r0-node2
kind: Node
memory: 2G
name: boot-0
smbios:
  serial: fb8f2417d0b4db30050719c31ce02a2e8141bbd8
volumes:
- copy-on-write: true
  image: ubuntu-cloud-image
  kind: image
  name: root
- kind: localds
  name: seed
  network-config: network.yml
  user-data: seed_boot-0.yml
- folder: sabakan-data
  kind: vvfat
  name: sabakan
---
cpu: 2
interfaces:
- r0-node1
- r0-node2
kind: Node
memory: 2G
name: rack0-cs1
smbios:
  serial: ba49d9a971c5a0344edfda5c8116745ea16fa4dd
tpm: true
uefi: true
volumes:
- kind: raw
  name: data1
  size: 30G
- kind: raw
  name: data2
  size: 30G
- copy-on-write: true
  image: docker-image
  kind: image
  name: extra0
---
cpu: 2
interfaces:
- r0-node1
- r0-node2
kind: Node
memory: 2G
name: rack0-cs2
smbios:
  serial: e6abb04b4645a765faf91f97536ec64f9cecfb61
tpm: true
uefi: true
volumes:
- kind: raw
  name: data1
  size: 30G
- kind: raw
  name: data2
  size: 30G
- copy-on-write: true
  image: docker-image
  kind: image
  name: extra0
---
cpu: 2
interfaces:
- r1-node1
- r1-node2
kind: Node
memory: 2G
name: boot-1
smbios:
  serial: fa362303b7af8c4291773ab496aaca16726beaa3
volumes:
- copy-on-write: true
  image: ubuntu-cloud-image
  kind: image
  name: root
- kind: localds
  name: seed
  network-config: network.yml
  user-data: seed_boot-1.yml
- folder: sabakan-data
  kind: vvfat
  name: sabakan
---
cpu: 2
interfaces:
- r1-node1
- r1-node2
kind: Node
memory: 2G
name: rack1-cs1
smbios:
  serial: 4ae0771764376e0184274e24e0b18abd8fa5f285
tpm: true
uefi: true
volumes:
- kind: raw
  name: data1
  size: 30G
- kind: raw
  name: data2
  size: 30G
- copy-on-write: true
  image: docker-image
  kind: image
  name: extra0
---
cpu: 2
interfaces:
- r1-node1
- r1-node2
kind: Node
memory: 2G
name: rack1-cs2
smbios:
  serial: aec899fb87747909c95a2decaa4f25899f07516e
tpm: true
uefi: true
volumes:
- kind: raw
  name: data1
  size: 30G
- kind: raw
  name: data2
  size: 30G
- copy-on-write: true
  image: docker-image
  kind: image
  name: extra0
---
cpu: 1
interfaces:
- r1-node1
- r1-node2
kind: Node
memory: 1G
name: rack1-ss1
smbios:
  serial: 1145129a085ecf521ab524028302a6b4a4e49a00
tpm: true
volumes:
- kind: raw
  name: data1
  size: 30G
- kind: raw
  name: data2
  size: 30G
- kind: raw
  name: data3
  size: 30G
- kind: raw
  name: data4
  size: 30G
- copy-on-write: true
  image: docker-image
  kind: image
  name: extra0
---
cpu: 1
interfaces:
- r1-node1
- r1-node2
kind: Node
memory: 1G
name: rack1-ss2
smbios:
  serial: 628c8c360d0113de66db14a225affcb85fb2a27f
tpm: true
volumes:
- kind: raw
  name: data1
  size: 30G
- kind: raw
  name: data2
  size: 30G
- kind: raw
  name: data3
  size: 30G
- kind: raw
  name: data4
  size: 30G
- copy-on-write: true
  image: docker-image
  kind: image
  name: extra0
---
apps:
- caps-retain:
  - CAP_NET_ADMIN
  - CAP_NET_BIND_SERVICE
  - CAP_NET_RAW
  image: docker://quay.io/cybozu/bird:2.0
  mount:
  - target: /etc/bird
    volume: config
  - target: /run/bird
    volume: run
  name: bird
  readonly-rootfs: true
- image: docker://quay.io/cybozu/ubuntu-debug:18.04
  name: debug
  readonly-rootfs: true
- image: docker://quay.io/cybozu/squid:3.5
  mount:
  - target: /etc/squid
    volume: config
  - target: /var/log/squid
    volume: squid-log
  - target: /var/spool/squid
    volume: squid-spool
  name: proxy
  readonly-rootfs: false
- args:
  - -f
  - /etc/chrony/chrony.conf
  image: docker://quay.io/cybozu/chrony:3.5
  mount:
  - target: /etc/chrony
    volume: config
  - target: /run
    volume: chrony-run
  - target: /var/lib/chrony
    volume: chrony-var-lib-chrony
  name: ntp
  readonly-rootfs: false
init-scripts:
- setup-iptables
interfaces:
- addresses:
  - 10.0.0.2/24
  network: internet
- addresses:
  - 10.72.16.2/20
  network: bmc
- addresses:
  - 10.0.49.3/32
  network: core-node0
- addresses:
  - 172.16.4.65/32
  network: core-ntp0
- addresses:
  - 172.16.4.66/32
  network: core-ntp1
- addresses:
  - 10.0.2.0/31
  network: core-to-s1
- addresses:
  - 10.0.2.2/31
  network: core-to-s2
- addresses:
  - 10.0.3.1/24
  network: core-to-ext
- addresses:
  - 10.0.4.1/24
  network: core-to-op
kind: Pod
name: core
volumes:
- folder: core-data
  kind: host
  name: config
  readonly: true
- kind: empty
  name: run
  readonly: false
- kind: empty
  mode: "0777"
  name: squid-log
  readonly: false
- kind: empty
  mode: "0777"
  name: squid-spool
  readonly: false
- kind: empty
  mode: "0777"
  name: chrony-run
  readonly: false
- kind: empty
  mode: "0777"
  name: chrony-var-lib-chrony
  readonly: false
---
apps:
- caps-retain:
  - CAP_NET_ADMIN
  - CAP_NET_BIND_SERVICE
  - CAP_NET_RAW
  image: docker://quay.io/cybozu/bird:2.0
  mount:
  - target: /etc/bird
    volume: config
  - target: /run/bird
    volume: run
  name: bird
  readonly-rootfs: true
- image: docker://quay.io/cybozu/ubuntu-debug:18.04
  name: debug
  readonly-rootfs: true
interfaces:
- addresses:
  - 10.0.2.1/31
  network: core-to-s1
- addresses:
  - 10.0.1.0/31
  network: s1-to-r0-1
- addresses:
  - 10.0.1.2/31
  network: s1-to-r0-2
- addresses:
  - 10.0.1.4/31
  network: s1-to-r1-1
- addresses:
  - 10.0.1.6/31
  network: s1-to-r1-2
kind: Pod
name: spine1
volumes:
- folder: spine1-data
  kind: host
  name: config
  readonly: true
- kind: empty
  name: run
  readonly: false
---
apps:
- caps-retain:
  - CAP_NET_ADMIN
  - CAP_NET_BIND_SERVICE
  - CAP_NET_RAW
  image: docker://quay.io/cybozu/bird:2.0
  mount:
  - target: /etc/bird
    volume: config
  - target: /run/bird
    volume: run
  name: bird
  readonly-rootfs: true
- image: docker://quay.io/cybozu/ubuntu-debug:18.04
  name: debug
  readonly-rootfs: true
interfaces:
- addresses:
  - 10.0.2.3/31
  network: core-to-s2
- addresses:
  - 10.0.1.8/31
  network: s2-to-r0-1
- addresses:
  - 10.0.1.10/31
  network: s2-to-r0-2
- addresses:
  - 10.0.1.12/31
  network: s2-to-r1-1
- addresses:
  - 10.0.1.14/31
  network: s2-to-r1-2
kind: Pod
name: spine2
volumes:
- folder: spine2-data
  kind: host
  name: config
  readonly: true
- kind: empty
  name: run
  readonly: false
---
apps:
- caps-retain:
  - CAP_NET_ADMIN
  - CAP_NET_BIND_SERVICE
  - CAP_NET_RAW
  image: docker://quay.io/cybozu/bird:2.0
  mount:
  - target: /etc/bird
    volume: config
  - target: /run/bird
    volume: run
  name: bird
  readonly-rootfs: true
- image: docker://quay.io/cybozu/ubuntu-debug:18.04
  name: debug
  readonly-rootfs: true
- args:
  - --keep-in-foreground
  - --pid-file
  - --log-facility=-
  - --dhcp-relay
  - 10.69.0.65,10.69.0.195
  caps-retain:
  - CAP_NET_BIND_SERVICE
  - CAP_NET_RAW
  - CAP_NET_BROADCAST
  image: docker://quay.io/cybozu/dnsmasq:2.79
  name: dhcp-relay
  readonly-rootfs: true
interfaces:
- addresses:
  - 10.0.1.1/31
  network: s1-to-r0-1
- addresses:
  - 10.0.1.9/31
  network: s2-to-r0-1
- addresses:
  - 10.69.0.65/26
  network: r0-node1
kind: Pod
name: rack0-tor1
volumes:
- folder: rack0-tor1-data
  kind: host
  name: config
  readonly: true
- kind: empty
  name: run
  readonly: false
---
apps:
- caps-retain:
  - CAP_NET_ADMIN
  - CAP_NET_BIND_SERVICE
  - CAP_NET_RAW
  image: docker://quay.io/cybozu/bird:2.0
  mount:
  - target: /etc/bird
    volume: config
  - target: /run/bird
    volume: run
  name: bird
  readonly-rootfs: true
- image: docker://quay.io/cybozu/ubuntu-debug:18.04
  name: debug
  readonly-rootfs: true
- args:
  - --keep-in-foreground
  - --pid-file
  - --log-facility=-
  - --dhcp-relay
  - 10.69.0.129,10.69.0.195
  caps-retain:
  - CAP_NET_BIND_SERVICE
  - CAP_NET_RAW
  - CAP_NET_BROADCAST
  image: docker://quay.io/cybozu/dnsmasq:2.79
  name: dhcp-relay
  readonly-rootfs: true
interfaces:
- addresses:
  - 10.0.1.3/31
  network: s1-to-r0-2
- addresses:
  - 10.0.1.11/31
  network: s2-to-r0-2
- addresses:
  - 10.69.0.129/26
  network: r0-node2
kind: Pod
name: rack0-tor2
volumes:
- folder: rack0-tor2-data
  kind: host
  name: config
  readonly: true
- kind: empty
  name: run
  readonly: false
---
apps:
- caps-retain:
  - CAP_NET_ADMIN
  - CAP_NET_BIND_SERVICE
  - CAP_NET_RAW
  image: docker://quay.io/cybozu/bird:2.0
  mount:
  - target: /etc/bird
    volume: config
  - target: /run/bird
    volume: run
  name: bird
  readonly-rootfs: true
- image: docker://quay.io/cybozu/ubuntu-debug:18.04
  name: debug
  readonly-rootfs: true
- args:
  - --keep-in-foreground
  - --pid-file
  - --log-facility=-
  - --dhcp-relay
  - 10.69.1.1,10.69.0.3
  caps-retain:
  - CAP_NET_BIND_SERVICE
  - CAP_NET_RAW
  - CAP_NET_BROADCAST
  image: docker://quay.io/cybozu/dnsmasq:2.79
  name: dhcp-relay
  readonly-rootfs: true
interfaces:
- addresses:
  - 10.0.1.5/31
  network: s1-to-r1-1
- addresses:
  - 10.0.1.13/31
  network: s2-to-r1-1
- addresses:
  - 10.69.1.1/26
  network: r1-node1
kind: Pod
name: rack1-tor1
volumes:
- folder: rack1-tor1-data
  kind: host
  name: config
  readonly: true
- kind: empty
  name: run
  readonly: false
---
apps:
- caps-retain:
  - CAP_NET_ADMIN
  - CAP_NET_BIND_SERVICE
  - CAP_NET_RAW
  image: docker://quay.io/cybozu/bird:2.0
  mount:
  - target: /etc/bird
    volume: config
  - target: /run/bird
    volume: run
  name: bird
  readonly-rootfs: true
- image: docker://quay.io/cybozu/ubuntu-debug:18.04
  name: debug
  readonly-rootfs: true
- args:
  - --keep-in-foreground
  - --pid-file
  - --log-facility=-
  - --dhcp-relay
  - 10.69.1.65,10.69.0.3
  caps-retain:
  - CAP_NET_BIND_SERVICE
  - CAP_NET_RAW
  - CAP_NET_BROADCAST
  image: docker://quay.io/cybozu/dnsmasq:2.79
  name: dhcp-relay
  readonly-rootfs: true
interfaces:
- addresses:
  - 10.0.1.7/31
  network: s1-to-r1-2
- addresses:
  - 10.0.1.15/31
  network: s2-to-r1-2
- addresses:
  - 10.69.1.65/26
  network: r1-node2
kind: Pod
name: rack1-tor2
volumes:
- folder: rack1-tor2-data
  kind: host
  name: config
  readonly: true
- kind: empty
  name: run
  readonly: false
---
apps:
- args:
  - infinity
  exec: /bin/sleep
  image: docker://quay.io/cybozu/ubuntu-debug:18.04
  name: ubuntu
  readonly-rootfs: false
init-scripts:
- setup-default-gateway-external
interfaces:
- addresses:
  - 10.0.3.2/24
  network: core-to-ext
kind: Pod
name: external
---
apps:
- args:
  - infinity
  exec: /bin/sleep
  image: docker://quay.io/cybozu/ubuntu-debug:18.04
  name: ubuntu
  readonly-rootfs: false
init-scripts:
- setup-default-gateway-operation
interfaces:
- addresses:
  - 10.0.4.2/24
  network: core-to-op
kind: Pod
name: operation
